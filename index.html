<!DOCTYPE html>
<html lang="en" class="bg-black text-white">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Avoid Scam together</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      #chat-container {
        width: 90%;
        max-width: 1000px;
        background-color: #1e1e1e;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        padding: 20px;
        color: white;
        margin: auto;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 80vh;
        overflow: hidden;
      }

      #messages {
        height: 80%;
        overflow-y: auto;
        border-bottom: 2px solid #444;
        margin-bottom: 20px;
        padding-right: 10px;
      }

      /* header row inside each .message */
      .message-header {
        display: flex;
        align-items: center;
        margin-bottom: 0.25rem;
      }

      /* circular bot icon */
      .sender-icon {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        margin-right: 8px;
        object-fit: cover;
      }

      /* bold name label */
      .label {
        font-weight: bold;
        font-size: 0.9rem;
        color: white;
      }

      

      .message.error {
        color: #721c24;
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        padding: 10px;
        border-radius: 8px;
        margin: 10px 0;
      }

      .message.system {
        color: #0c5460;
        background-color: #d1ecf1;
        border: 1px solid #bee5eb;
        padding: 10px;
        border-radius: 8px;
        margin: 10px 0;
      }

      #input-container {
        display: flex;
        align-items: center;
        border-top: 2px solid #444;
        padding-top: 10px;
      }

      #input-container input {
        flex: 1;
        padding: 12px;
        border-radius: 25px;
        border: 1px solid #555;
        background-color: #222;
        color: #fff;
        margin-right: 10px;
        font-size: 16px;
        outline: none;
        transition: all 0.3s;
      }

      #input-container input:focus {
        border-color: #4a90e2;
        box-shadow: 0 0 6px rgba(74, 144, 226, 0.5);
      }

      #input-container button {
        padding: 12px 18px;
        border: none;
        background-color: #4a90e2;
        color: white;
        border-radius: 25px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      #input-container button:hover {
        background-color: #357ab7;
      }

      #input-container input:disabled,
      #input-container button:disabled {
        background-color: #555;
        cursor: not-allowed;
      }

      footer {
        background-color: #222;
        color: #888;
        text-align: center;
        padding: 20px;
      }

      footer a {
        color: #888;
        text-decoration: none;
        font-weight: bold;
        transition: color 0.3s;
      }

      footer a:hover {
        color: #fff;
      }

      /* ─── flex layout & alignment ───────────────────── */
      /* 1) THE OUTER WRAPPER: no bubble styling here */
      .message {
        display: flex;
        align-items: flex-start;
        margin: 12px 0;
        padding: 0;       /* remove old padding */
        background: none; /* remove old background */
      }

      /* 2) FLOAT LEFT/RIGHT */
      .message.assistant { justify-content: flex-start; }
      .message.user      { justify-content: flex-end;   }

      /* 3) THE CHAT BUBBLE */
      .message-content {
        padding: 10px 14px;
        border-radius: 8px;
        line-height: 1.4;
        background-color: #333;
        color: #ddd;
        max-width: 100%;
      }

      /* 4) OVERRIDE FOR USER BUBBLE */
      .message.user .message-content {
        background-color: #4a90e2;
        color: #fff;
      }


      /* assistant left, user right */
      .message.assistant { justify-content: flex-start; }
      .message.user      { justify-content: flex-end;   }

      /* ─── avatar container ─────────────────────────── */
      .message-avatar {
        width: 32px;
        height: 32px;
        margin-right: 8px;
      }
      .message.user .message-avatar {
        display: none;  /* no avatar for user */
      }

      /* ─── body (name + bubble) ─────────────────────── */
      .message-body {
        display: flex;
        flex-direction: column;
        max-width: 75%;
      }

      /* sender name above bubble */
      .sender {
        font-weight: bold;
        font-size: 1.1rem;
        margin-bottom: 4px;
        color: white;
      }

      .message.assistant .message-content {
        background-color: #333;
        color: #ddd;
      }

      .message.user .message-content {
        background-color: #4a90e2;
        color: #fff;
      }

      /* bot icon styling */
      .sender-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        object-fit: cover;
      }

    </style>
  </head>
  <body class="min-h-screen flex flex-col scroll-smooth bg-black text-white">
    <header class="flex items-center justify-center h-screen p-4">
      <div class="text-center space-y-6 w-screen">
        <h1
          class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600"
        >
          YOU JUST GOT SCAMMED!
        </h1>
        <h1
          class="text-4xl sm:text-3xl md:text-2xl lg:text-3xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600"
        >
          But you can prevent it with us
        </h1>
        <div class="w-screen">
          <p
            class="text-lg sm:text-xl md:text-xl text-gray-300 max-w-3xl mx-auto"
          >
            Chat with our chat-bot <br />
            Learn how to avoid being scammed
          </p>
        </div>
      </div>
    </header>
    <!-- Features Section -->

    <section class="py-16 px-4 sm:px-6 lg:px-8">
      <div class="max-w-7xl mx-auto space-y-12">
        <h2
          class="text-3xl sm:text-4xl font-semibold text-center text-gray-200"
        >
          Key Features
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
          <!-- Feature Card 1 -->
          <div
            class="bg-gray-900 rounded-xl p-6 shadow-lg border border-gray-800 hover:border-gray-700 transition-all duration-300 hover:shadow-xl"
          >
            <i data-lucide="mail" class="w-8 h-8 text-yellow-400 mb-4"></i>
            <h3 class="text-xl font-semibold text-white mb-2">
              Friend Phishing Test
            </h3>
            <p class="text-gray-300">
              Safely prank your friends by generating a phishing simulation
              link, helping them learn to detect scams in a real-world way.
            </p>
          </div>

          <!-- Feature Card 2 -->
          <div
            class="bg-gray-900 rounded-xl p-6 shadow-lg border border-gray-800 hover:border-gray-700 transition-all duration-300 hover:shadow-xl"
          >
            <i data-lucide="file-text" class="w-8 h-8 text-pink-400 mb-4"></i>
            <h3 class="text-xl font-semibold text-white mb-2">
              Phishing Email AI Generator
            </h3>
            <p class="text-gray-300">
              Use AI to generate realistic (but safe) phishing emails designed
              to educate users on how scams look in the wild.
            </p>
          </div>

          <!-- Feature Card 3 -->
          <div
            class="bg-gray-900 rounded-xl p-6 shadow-lg border border-gray-800 hover:border-gray-700 transition-all duration-300 hover:shadow-xl"
          >
            <i
              data-lucide="alert-triangle"
              class="w-8 h-8 text-red-400 mb-4"
            ></i>
            <h3 class="text-xl font-semibold text-white mb-2">
              Click Analysis and Education
            </h3>
            <p class="text-gray-300">
              After clicking a simulated phishing link, users receive instant
              feedback explaining what made the email suspicious and how to stay
              safer next time.
            </p>
          </div>

          <!-- Feature Card 4 -->
          <div
            class="bg-gray-900 rounded-xl p-6 shadow-lg border border-gray-800 hover:border-gray-700 transition-all duration-300 hover:shadow-xl"
          >
            <i data-lucide="shield" class="w-8 h-8 text-green-400 mb-4"></i>
            <h3 class="text-xl font-semibold text-white mb-2">
              AI Red Team Challenge
            </h3>
            <p class="text-gray-300">
              Test your skills against our AI Red Team! Identify whether
              messages are safe or phishing attempts through quick interactive
              challenges.
            </p>
          </div>

          <!-- Feature Card 5 -->
          <div
            class="bg-gray-900 rounded-xl p-6 shadow-lg border border-gray-800 hover:border-gray-700 transition-all duration-300 hover:shadow-xl"
          >
            <i data-lucide="bot" class="w-8 h-8 text-purple-400 mb-4"></i>
            <h3 class="text-xl font-semibold text-white mb-2">
              AI Cybersecurity Trainer
            </h3>
            <p class="text-gray-300">
              Chat live with our AI Security Coach to learn phishing defenses,
              get simple tips, and understand cyber threats in easy language.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Chat Container -->
    <div id="chat-container">
      <div id="messages"></div>
      <div id="input-container">
        <input type="text" id="message-input" placeholder="Type a message..." />
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <p>© <span id="year"></span> Aryan Khanna. All rights reserved.</p>
      <a
        href="https://github.com/aryank09/UWB-Hacks-25"
        target="_blank"
        rel="noopener noreferrer"
        class="text-white hover:text-gray-500 transition-colors duration-300 font-semibold text-lg flex items-center gap-2"
      >
        <i data-lucide="github" class="w-5 h-5"></i> GitHub
      </a>
    </footer>

    <script>
      // ─── BOT + USER CONFIG ─────────────────────────────
      const BOT_NAME = "Phishy";
      const BOT_ICON = "/static/chatbot_icon.png";  // put your PNG in ./static/
      const USER_NAME = "You";
      // ────────────────────────────────────────────────────
      firstMessage = `Hey there! 👋  
No worries — you're safe here.  
You just experienced a **simulated phishing attempt** — and it's a good thing!  
  
Phishing is when someone tries to trick you into clicking bad links, giving up passwords, or downloading harmful stuff. It happens every day to millions of people.  
  
Let’s work together to make sure you can **spot and stop** phishing attacks in the future! 🚀  

Which would you like to do first?
1) Learn what phishing is and how it tricks people
2) Get three quick, easy safety tips
3) Try a short quiz to spot a phishy message

(Type "1" "2" or "3" to select an option or ask any question!)`;

      document
        .getElementById("message-input")
        .addEventListener("keydown", function (event) {
          if (event.key === "Enter") {
            sendMessage();
          }
        });

      displayMessage(firstMessage, "assistant");

      async function sendMessage() {
        const input = document.getElementById("message-input");
        const button = document.querySelector("#input-container button");
        const message = input.value;
        if (!message) return;

        // Display user message
        displayMessage(message, "user");

        // Clear input and disable controls
        input.value = "";
        input.disabled = true;
        button.disabled = true;

        try {
          const response = await fetch("http://localhost:8001/chat", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ content: message, source: "user" }),
          });

          const data = await response.json();
          if (!response.ok) {
            // Handle error response
            if (data.detail && data.detail.type === "error") {
              displayMessage(data.detail.content, "error");
            } else {
              displayMessage(
                "Error: " + (data.detail || "Unknown error"),
                "error"
              );
            }
          } else {
            displayMessage(data.content, "assistant");
          }
        } catch (error) {
          console.error("Error:", error);
          displayMessage("Error: Could not reach the server.", "error");
        } finally {
          // Re-enable controls
          input.disabled = false;
          button.disabled = false;
          input.focus();
        }
      }

      function displayMessage(content, source) {
        const messagesContainer = document.getElementById("messages");

        // 1) outer wrapper
        const msgEl = document.createElement("div");
        msgEl.className = `message ${source}`;

        // 2) avatar slot
        const avatarEl = document.createElement("div");
        avatarEl.className = "message-avatar";
        if (source === "assistant") {
          const img = document.createElement("img");
          img.src = BOT_ICON;
          img.alt = BOT_NAME;
          img.className = "sender-icon";
          avatarEl.appendChild(img);
        }
        msgEl.appendChild(avatarEl);

        // 3) body (name + bubble)
        const bodyEl = document.createElement("div");
        bodyEl.className = "message-body";

        // 3a) sender name
        const senderEl = document.createElement("div");
        senderEl.className = "sender";
        senderEl.textContent = source === "assistant" ? BOT_NAME : USER_NAME;
        bodyEl.appendChild(senderEl);

        // 3b) bubble content
        const contentEl = document.createElement("div");
        contentEl.className = "message-content";
        const formatted = content
          .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
          .replace(/\n/g, "<br>")
          .replace(/`(.*?)`/g, "<code>$1</code>");
        contentEl.innerHTML = formatted;
        bodyEl.appendChild(contentEl);

        msgEl.appendChild(bodyEl);

        // 4) add to DOM
        messagesContainer.appendChild(msgEl);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }



      async function loadHistory() {
        try {
          const response = await fetch("http://localhost:8001/history");
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          const history = await response.json();
          history.forEach((message) => {
            displayMessage(message.content, message.source);
          });
        } catch (error) {
          console.error("Error loading history:", error);
        }
      }

      // Load chat history when the page loads
      window.onload = loadHistory;
    </script>
  </body>
</html>
